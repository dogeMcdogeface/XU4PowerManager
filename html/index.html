<head>
    <!-- Load plotly.js into the DOM -->
    <script src='https://cdn.plot.ly/plotly-2.4.2.min.js'></script>
</head>

<body>
<div id='myDiv'><!-- Plotly chart will be drawn inside this DIV --></div>

<script>


    /************** REQUEST HISTORY ******************/
    let requestHistory = new XMLHttpRequest();
    requestHistory.responseType = 'json';
    requestHistory.open('GET', window.location.href + "history");
    requestHistory.onload = function () {
        console.log(requestHistory.response)

        /************** CREATE PLOT **********************/
        data = requestHistory.response

        data.sort((a, b) => new Date(a.Time).getTime() - new Date(b.Time).getTime());


        console.log(data)


        var timetable = data.map(function (item) {
            return item.Time;
        });
        var Thermal0 = data.map(function (item) {
            return item.Thermal0 / 1000;
        });


        console.log(timetable)
        console.log(Thermal0)


        var trace1 = {
            x: timetable,
            y: Thermal0,
            type: 'scatter'
        };

        var trace2 = {
            x: timetable,
            y: Thermal0,
            type: 'scatter'
        };


        Plotly.newPlot('myDiv', [{
            y: Thermal0,
            x: timetable,
            mode: 'lines',
            line: {color: '#80CAF6'}
        }, {
            y: Thermal0,
            x: timetable,
            mode: 'lines',
            line: {color: '#DF56F1'}
        }]);


    };
    requestHistory.send()


    /************** REQUEST DATA UPDATE **************/
    let requestLast = new XMLHttpRequest();
    requestLast.responseType = 'json';
    requestLast.onload = function () {
        //console.log(requestLast.response)
        var data = requestLast.response
        var time1 = Date.parse(data.Time)
        var time2 = Date.parse(data.Time)
        time2.setMinutes(time1.getMinutes() - 2);



        var minuteView = {
            xaxis: {
                type: 'date',
                range: [time2,time1]
            }
        };

        //console.log(time2,time1)

        Plotly.relayout('myDiv', minuteView);


        Plotly.extendTraces('myDiv', {
            y: [[data.Thermal0 / 1000], [data.Thermal0 / 1000]],
            x: [[data.Time], [data.Time]]

        }, [0, 1])

    };
    setInterval(function() {
        requestLast.open('GET', window.location.href + "last");
        requestLast.send()
    }, 100);


</script>

</body>
</html>